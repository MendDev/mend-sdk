!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MendSdk={})}(this,(function(t){"use strict";class e{constructor(t){var e,i;if(this.jwt=null,this.jwtExpiresAt=0,!(null==t?void 0:t.apiEndpoint)||!(null==t?void 0:t.email)||!(null==t?void 0:t.password)||void 0===t.adminOrgId)throw Object.assign(new Error("apiEndpoint, email, password, and adminOrgId are required"),{code:"SDK_CONFIG"});this.apiEndpoint=t.apiEndpoint.replace(/\/$/,""),this.email=t.email,this.password=t.password,this.adminOrgId=t.adminOrgId,this.tokenTTL=null!==(e=t.tokenTTL)&&void 0!==e?e:55,this.defaultHeaders=null!==(i=t.defaultHeaders)&&void 0!==i?i:{}}async authenticate(){const t=(await this.fetch("POST","/session",{email:this.email,password:this.password,orgId:this.adminOrgId},{},!0)).token;if(!t)throw Object.assign(new Error("JWT not returned by /session"),{code:"AUTH_MISSING_TOKEN"});this.jwt=t,this.jwtExpiresAt=Date.now()+6e4*this.tokenTTL}async ensureAuth(){(!this.jwt||Date.now()>=this.jwtExpiresAt)&&await this.authenticate()}async fetch(t,e,i,s={},n=!1,a){n||await this.ensureAuth();const o=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",r=this.apiEndpoint+e+o,d={"Content-Type":"application/json",Accept:"application/json",...this.defaultHeaders};!n&&this.jwt&&(d["X-Access-Token"]=this.jwt);const h=await fetch(r,{method:t,headers:d,body:i?JSON.stringify(i):void 0,signal:a});if(!h.ok){throw Object.assign(new Error(`HTTP ${h.status} â€“ ${h.statusText}`),{code:"HTTP_ERROR",status:h.status})}const u=await h.text();return u?JSON.parse(u):void 0}async request(t,e,i,s,n){return this.fetch(t,e,i,s,!1,n)}getOrg(t,e){return this.request("GET",`/org/${t}`,void 0,void 0,e)}getUser(t,e){return this.request("GET",`/user/${t}`,void 0,void 0,e)}listPatients(t,e=1,i=25,s){return this.request("GET","/patient",void 0,{search:t,page:e,limit:i},s)}getAppointment(t,e){return this.request("GET",`/appointment/${t}`,void 0,void 0,e)}createAppointment(t,e){return this.request("POST","/appointment",t,void 0,e)}}t.MendSdk=e,t.default=e,Object.defineProperty(t,"__esModule",{value:!0})}));
